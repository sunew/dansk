<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dansk — Learn Danish</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #f0ece3; --paper: #faf8f4; --ink: #1c1814; --muted: #8a8078;
  --accent: #c94f1e; --accent2: #2c5f8a; --green: #2d7a4f; --border: #d6cfc4;
}
body { font-family: 'DM Mono', monospace; background: var(--bg); color: var(--ink); min-height: 100vh; display: flex; flex-direction: column; }

/* ── HEADER ── */
header {
  padding: 20px 40px 16px; border-bottom: 2px solid var(--ink);
  background: var(--paper); display: flex; align-items: center; gap: 12px; flex-wrap: wrap;
}
h1 { font-family: 'Playfair Display', serif; font-size: 2.2rem; letter-spacing: -0.5px; }
h1 em { color: var(--accent); font-style: italic; }
.tagline { font-size: 0.68rem; color: var(--muted); letter-spacing: 0.14em; text-transform: uppercase; }
.version {
  margin-left: auto; font-size: 0.6rem; color: var(--muted);
  letter-spacing: 0.12em; text-transform: uppercase;
  background: var(--bg); border: 1px solid var(--border);
  border-radius: 2px; padding: 3px 10px; white-space: nowrap;
}

/* ── NAV ── */
nav { display: flex; background: var(--paper); border-bottom: 1px solid var(--border); padding: 0 40px; overflow-x: auto; }
.tab {
  padding: 11px 20px; font-family: 'DM Mono', monospace; font-size: 0.7rem;
  letter-spacing: 0.12em; text-transform: uppercase; cursor: pointer; border: none;
  background: none; color: var(--muted); border-bottom: 3px solid transparent;
  transition: color 0.15s, border-color 0.15s; white-space: nowrap;
}
.tab.active { color: var(--ink); border-bottom-color: var(--accent); }
.tab:hover { color: var(--ink); }

/* ── MAIN ── */
main { flex: 1; padding: 32px 40px; max-width: 940px; margin: 0 auto; width: 100%; }
.view { display: none; animation: fadeIn 0.2s ease; }
.view.active { display: block; }
@keyframes fadeIn { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:none; } }
.drill-wrap { max-width: 560px; margin: 0 auto; }

/* ── LABELS ── */
.section-label { font-size: 0.65rem; letter-spacing: 0.18em; text-transform: uppercase; color: var(--muted); margin-bottom: 16px; }
.sub-label { font-size: 0.6rem; letter-spacing: 0.14em; text-transform: uppercase; color: var(--muted); margin-top: 16px; margin-bottom: 6px; }

/* ── FILTER BUTTONS ── */
.filter-row { display: flex; gap: 7px; margin-bottom: 10px; flex-wrap: wrap; }
.filter-btn {
  padding: 5px 12px; border: 1.5px solid var(--border); border-radius: 2px;
  background: none; font-family: 'DM Mono', monospace; font-size: 0.66rem;
  letter-spacing: 0.08em; text-transform: uppercase; cursor: pointer; color: var(--muted); transition: all 0.15s;
}
.filter-btn.active { background: var(--ink); color: #fff; border-color: var(--ink); }
.filter-btn:hover:not(.active) { border-color: var(--ink); color: var(--ink); }

/* ── CARD ── */
.card {
  background: var(--paper); border: 1.5px solid var(--border); border-radius: 4px;
  padding: 48px 40px 36px; text-align: center; box-shadow: 4px 4px 0 var(--border);
  position: relative; min-height: 280px; display: flex; flex-direction: column;
  justify-content: center; gap: 14px; margin-bottom: 0;
}
.card-meta {
  position: absolute; top: 16px; left: 20px; right: 20px;
  display: flex; justify-content: space-between;
  font-size: 0.6rem; color: var(--muted); letter-spacing: 0.1em; text-transform: uppercase;
}
.card-prompt-label { font-size: 0.65rem; letter-spacing: 0.14em; text-transform: uppercase; color: var(--muted); }
.card-main { font-family: 'Playfair Display', serif; font-size: 2rem; font-style: italic; color: var(--ink); line-height: 1.2; }
.card-sub { font-size: 0.75rem; color: var(--muted); }

/* pronoun badge */
.pronoun-block { display: flex; flex-direction: column; align-items: center; gap: 6px; }
.pronoun-badge {
  display: inline-block; background: var(--ink); color: #fff;
  padding: 6px 22px; border-radius: 2px; font-family: 'DM Mono', monospace;
  font-size: 1.1rem; letter-spacing: 0.08em;
}
.pronoun-en { font-size: 0.7rem; color: var(--muted); }

/* answer */
.answer-input {
  width: 100%; padding: 12px 16px; font-family: 'DM Mono', monospace; font-size: 1.1rem;
  border: 1.5px solid var(--border); border-radius: 2px; background: var(--bg);
  color: var(--ink); text-align: center; outline: none; transition: border-color 0.15s; margin-top: 8px;
}
.answer-input:focus { border-color: var(--accent2); }
.answer-input.correct { border-color: var(--green); background: #edf7f2; }
.answer-input.wrong { border-color: var(--accent); background: #fef0ec; }

.feedback-msg { font-size: 0.72rem; letter-spacing: 0.06em; min-height: 18px; margin-top: 4px; }
.feedback-msg.correct { color: var(--green); }
.feedback-msg.wrong { color: var(--accent); }

/* reveal */
.reveal-box { display: none; padding: 14px 16px; background: var(--bg); border: 1.5px solid var(--border); border-radius: 2px; margin-top: 10px; }
.reveal-box.show { display: block; }
.reveal-answer { font-family: 'Playfair Display', serif; font-size: 1.5rem; color: var(--accent2); margin-bottom: 4px; }
.reveal-note { font-size: 0.7rem; color: var(--muted); margin-bottom: 8px; line-height: 1.5; }
.reveal-note strong { color: var(--ink); }

/* conjugation mini table */
.conj-mini { width: 100%; border-collapse: collapse; margin-top: 8px; font-size: 0.72rem; text-align: left; }
.conj-mini td { padding: 4px 8px; border-bottom: 1px solid var(--border); }
.conj-mini td:first-child { color: var(--muted); width: 100px; }
.conj-mini td:last-child { color: var(--accent2); font-weight: 500; }
.conj-mini tr.hl td { background: rgba(44,95,138,0.10); }
.conj-mini tr:last-child td { border-bottom: none; }

/* animal forms table in reveal */
.forms-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px 12px; margin-top: 10px; font-size: 0.72rem; text-align: left; }
.forms-grid .form-cell-label { color: var(--muted); font-size: 0.6rem; letter-spacing: 0.08em; text-transform: uppercase; }
.forms-grid .form-cell-val { color: var(--accent2); font-weight: 500; }

/* actions */
.card-actions { display: flex; gap: 10px; margin-top: 18px; justify-content: center; }
.btn {
  padding: 10px 24px; border: 1.5px solid var(--ink); border-radius: 2px;
  font-family: 'DM Mono', monospace; font-size: 0.72rem; letter-spacing: 0.1em;
  text-transform: uppercase; cursor: pointer; background: none; color: var(--ink); transition: all 0.15s;
}
.btn:hover { background: var(--ink); color: #fff; }
.btn.primary { background: var(--ink); color: #fff; }
.btn.primary:hover { background: var(--accent); border-color: var(--accent); }
.btn.ghost { border-color: var(--border); color: var(--muted); }
.btn.ghost:hover { background: var(--border); color: var(--ink); }
.empty-msg { text-align: center; color: var(--muted); padding: 60px 0; font-size: 0.85rem; line-height: 1.8; }

/* ── REFERENCE ── */
.ref-controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
.search-input {
  flex: 1; min-width: 180px; padding: 9px 14px; font-family: 'DM Mono', monospace;
  font-size: 0.8rem; border: 1.5px solid var(--border); border-radius: 2px;
  background: var(--paper); color: var(--ink); outline: none; transition: border-color 0.15s;
}
.search-input:focus { border-color: var(--accent2); }
.search-input::placeholder { color: var(--muted); }
select {
  padding: 8px 12px; font-family: 'DM Mono', monospace; font-size: 0.75rem;
  border: 1.5px solid var(--border); border-radius: 2px; background: var(--paper);
  color: var(--ink); outline: none; cursor: pointer;
}
.table-wrap { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; }
thead tr { border-bottom: 2px solid var(--ink); }
th { padding: 8px 12px; font-size: 0.6rem; letter-spacing: 0.14em; text-transform: uppercase; color: var(--muted); text-align: left; font-weight: 400; white-space: nowrap; }
td { padding: 9px 12px; font-size: 0.8rem; border-bottom: 1px solid var(--border); vertical-align: top; }
tr:hover td { background: var(--paper); }
.cell-en { font-family: 'Playfair Display', serif; font-style: italic; font-size: 0.92rem; }
.cell-da { color: var(--accent2); font-weight: 500; }
.tag { display: inline-block; padding: 2px 7px; border: 1px solid var(--border); border-radius: 2px; font-size: 0.58rem; letter-spacing: 0.08em; text-transform: uppercase; color: var(--muted); }
.gender-tag { display: inline-block; padding: 2px 6px; border-radius: 2px; font-size: 0.58rem; letter-spacing: 0.08em; text-transform: uppercase; font-weight: 500; }
.gender-en { background: #e8f0f7; color: var(--accent2); }
.gender-et { background: #f7ede8; color: var(--accent); }

@media (max-width: 600px) {
  header, nav, main { padding-left: 20px; padding-right: 20px; }
  h1 { font-size: 1.6rem; }
  .card { padding: 40px 20px 28px; }
  .card-main { font-size: 1.5rem; }
}
</style>
</head>
<body>

<header>
  <div>
    <h1>D<em>a</em>nsk</h1>
    <div class="tagline">Danish Practice</div>
  </div>
  <div class="version">v2.1</div>
</header>

<nav>
  <button class="tab active" onclick="showView('translate',this)">Translate</button>
  <button class="tab" onclick="showView('conjugation',this)">Conjugation</button>
  <button class="tab" onclick="showView('animals',this)">Animals</button>
  <button class="tab" onclick="showView('reference',this)">Reference</button>
</nav>

<main>

  <!-- ══ TRANSLATE ══ -->
  <div id="view-translate" class="view active">
    <div class="drill-wrap">
      <div class="section-label">Translate — English to Danish</div>
      <div class="sub-label">Category</div>
      <div class="filter-row" id="tr-cat-filters"></div>
      <div id="tr-card"></div>
    </div>
  </div>

  <!-- ══ CONJUGATION ══ -->
  <div id="view-conjugation" class="view">
    <div class="drill-wrap">
      <div class="section-label">Conjugation drill — pronoun · tense · verb</div>
      <div class="sub-label">Verb</div>
      <div class="filter-row" id="cj-verb-filters"></div>
      <div class="sub-label">Tense</div>
      <div class="filter-row" id="cj-tense-filters"></div>
      <div id="cj-card"></div>
    </div>
  </div>

  <!-- ══ ANIMALS ══ -->
  <div id="view-animals" class="view">
    <div class="drill-wrap">
      <div class="section-label">Animals — Danish nouns with gender & forms</div>
      <div class="sub-label">Group</div>
      <div class="filter-row" id="an-group-filters"></div>
      <div class="sub-label">Practice mode</div>
      <div class="filter-row" id="an-mode-filters">
        <button class="filter-btn active" onclick="setAnimalMode('en-da',this)">English → Danish</button>
        <button class="filter-btn" onclick="setAnimalMode('da-en',this)">Danish → English</button>
      </div>
      <div id="an-card"></div>
    </div>
  </div>

  <!-- ══ REFERENCE ══ -->
  <div id="view-reference" class="view">
    <div class="section-label">Reference</div>
    <div class="filter-row" id="ref-type-filters">
      <button class="filter-btn active" onclick="setRefType('verbs',this)">Verbs</button>
      <button class="filter-btn" onclick="setRefType('animals',this)">Animals</button>
    </div>

    <!-- verb reference -->
    <div id="ref-verbs-section">
      <div class="ref-controls">
        <input class="search-input" id="ref-verb-search" type="text" placeholder="Search…" oninput="renderVerbRef()">
        <select id="ref-verb-cat" onchange="renderVerbRef()">
          <option value="all">All categories</option>
        </select>
      </div>
      <div class="table-wrap">
        <table>
          <thead><tr>
            <th>English</th><th>Infinitive</th>
            <th>Nutid<br><span style="font-weight:300;opacity:0.6;">Present</span></th>
            <th>Datid<br><span style="font-weight:300;opacity:0.6;">Past</span></th>
            <th>Førnutid<br><span style="font-weight:300;opacity:0.6;">Pres. perfect</span></th>
            <th>Førdatid<br><span style="font-weight:300;opacity:0.6;">Past perfect</span></th>
            <th>Fremtid<br><span style="font-weight:300;opacity:0.6;">Future</span></th>
            <th>Konditionalis<br><span style="font-weight:300;opacity:0.6;">Conditional</span></th>
            <th>Fremtid perf.<br><span style="font-weight:300;opacity:0.6;">Fut. perfect</span></th>
            <th>Passiv<br><span style="font-weight:300;opacity:0.6;">Passive</span></th>
            <th>Bydemåde<br><span style="font-weight:300;opacity:0.6;">Imperative</span></th>
            <th>Cat.</th>
          </tr></thead>
          <tbody id="ref-verb-body"></tbody>
        </table>
      </div>
    </div>

    <!-- animal reference -->
    <div id="ref-animals-section" style="display:none;">
      <div class="ref-controls">
        <input class="search-input" id="ref-animal-search" type="text" placeholder="Search…" oninput="renderAnimalRef()">
        <select id="ref-animal-group" onchange="renderAnimalRef()">
          <option value="all">All groups</option>
        </select>
      </div>
      <div class="table-wrap">
        <table>
          <thead><tr>
            <th>English</th><th>Danish</th><th>Gender</th><th>Plural</th>
            <th>Male</th><th>Female</th><th>Young</th><th>Group</th>
          </tr></thead>
          <tbody id="ref-animal-body"></tbody>
        </table>
      </div>
    </div>
  </div>

</main>

<script>
// ═══════════════════════════════════════════════
// PRONOUNS
// ═══════════════════════════════════════════════
const PRONOUNS = [
  { da:'jeg',     en:'I' },
  { da:'du',      en:'you (sing.)' },
  { da:'han/hun', en:'he / she' },
  { da:'den/det', en:'it' },
  { da:'vi',      en:'we' },
  { da:'I',       en:'you (pl.)' },
  { da:'de',      en:'they' },
];

// ═══════════════════════════════════════════════
// TENSES
// ═══════════════════════════════════════════════
// key: field name on verb object
const TENSES = [
  { key:'present',      label:'Present',        da:'Nutid',                note:'jeg er' },
  { key:'past',         label:'Past',           da:'Datid',                note:'jeg var' },
  { key:'presPerfect',  label:'Pres. perfect',  da:'Førnutid',             note:'jeg har været' },
  { key:'pastPerfect',  label:'Past perfect',   da:'Førdatid',             note:'jeg havde været' },
  { key:'future',       label:'Future',         da:'Fremtid',              note:'jeg vil være' },
  { key:'conditional',  label:'Conditional',    da:'Konditionalis',        note:'jeg ville være' },
  { key:'futPerfect',   label:'Fut. perfect',   da:'Fremtid perfektum',    note:'jeg vil have været' },
  { key:'passive',      label:'Passive',        da:'Passiv',               note:'det bruges' },
  { key:'imperative',   label:'Imperative',     da:'Bydemåde',             note:'vær!' },
];

// ═══════════════════════════════════════════════
// VERBS
// Fields: english, danish, present, past, presPerfect, pastPerfect,
//         future, conditional, futPerfect, passive, imperative, category
// Notes on Danish tenses:
//  - presPerfect = har + past participle
//  - pastPerfect = havde + past participle
//  - futPerfect  = vil have + past participle
//  - passive     = infinitive stem + -es  OR  blive + past participle
//  - imperative  = verb stem (no ending)
// ═══════════════════════════════════════════════
const VERBS = [
  // ── Essential ──
  {
    english:'to be', danish:'at være', category:'Essential',
    present:'er', past:'var', presPerfect:'har været', pastPerfect:'havde været',
    future:'vil være', conditional:'ville være', futPerfect:'vil have været',
    passive:'bliver/er', imperative:'vær',
  },
  {
    english:'to have', danish:'at have', category:'Essential',
    present:'har', past:'havde', presPerfect:'har haft', pastPerfect:'havde haft',
    future:'vil have', conditional:'ville have', futPerfect:'vil have haft',
    passive:'haves', imperative:'hav',
  },
  {
    english:'to become', danish:'at blive', category:'Essential',
    present:'bliver', past:'blev', presPerfect:'har været', pastPerfect:'havde været',
    future:'vil blive', conditional:'ville blive', futPerfect:'vil have været',
    passive:'bliver/blives', imperative:'bliv',
  },
  {
    english:'to do / make', danish:'at gøre', category:'Essential',
    present:'gør', past:'gjorde', presPerfect:'har gjort', pastPerfect:'havde gjort',
    future:'vil gøre', conditional:'ville gøre', futPerfect:'vil have gjort',
    passive:'gøres', imperative:'gør',
  },
  {
    english:'to get', danish:'at få', category:'Essential',
    present:'får', past:'fik', presPerfect:'har fået', pastPerfect:'havde fået',
    future:'vil få', conditional:'ville få', futPerfect:'vil have fået',
    passive:'fås', imperative:'få',
  },
  {
    english:'to say', danish:'at sige', category:'Essential',
    present:'siger', past:'sagde', presPerfect:'har sagt', pastPerfect:'havde sagt',
    future:'vil sige', conditional:'ville sige', futPerfect:'vil have sagt',
    passive:'siges', imperative:'sig',
  },
  {
    english:'to know (fact)', danish:'at vide', category:'Essential',
    present:'ved', past:'vidste', presPerfect:'har vidst', pastPerfect:'havde vidst',
    future:'vil vide', conditional:'ville vide', futPerfect:'vil have vidst',
    passive:'vides', imperative:'vid',
  },
  {
    english:'to know (person)', danish:'at kende', category:'Essential',
    present:'kender', past:'kendte', presPerfect:'har kendt', pastPerfect:'havde kendt',
    future:'vil kende', conditional:'ville kende', futPerfect:'vil have kendt',
    passive:'kendes', imperative:'kend',
  },
  {
    english:'to want', danish:'at ville', category:'Essential',
    present:'vil', past:'ville', presPerfect:'har villet', pastPerfect:'havde villet',
    future:'vil ville', conditional:'ville ville', futPerfect:'vil have villet',
    passive:'—', imperative:'—',
  },
  {
    english:'to can', danish:'at kunne', category:'Essential',
    present:'kan', past:'kunne', presPerfect:'har kunnet', pastPerfect:'havde kunnet',
    future:'vil kunne', conditional:'ville kunne', futPerfect:'vil have kunnet',
    passive:'—', imperative:'—',
  },
  {
    english:'to must', danish:'at skulle', category:'Essential',
    present:'skal', past:'skulle', presPerfect:'har skullet', pastPerfect:'havde skullet',
    future:'vil skulle', conditional:'ville skulle', futPerfect:'vil have skullet',
    passive:'—', imperative:'—',
  },
  {
    english:'to may', danish:'at måtte', category:'Essential',
    present:'må', past:'måtte', presPerfect:'har måttet', pastPerfect:'havde måttet',
    future:'vil måtte', conditional:'ville måtte', futPerfect:'vil have måttet',
    passive:'—', imperative:'—',
  },
  // ── Movement ──
  {
    english:'to go', danish:'at gå', category:'Movement',
    present:'går', past:'gik', presPerfect:'har gået', pastPerfect:'havde gået',
    future:'vil gå', conditional:'ville gå', futPerfect:'vil have gået',
    passive:'gås', imperative:'gå',
  },
  {
    english:'to come', danish:'at komme', category:'Movement',
    present:'kommer', past:'kom', presPerfect:'har kommet', pastPerfect:'havde kommet',
    future:'vil komme', conditional:'ville komme', futPerfect:'vil have kommet',
    passive:'kommes', imperative:'kom',
  },
  {
    english:'to run', danish:'at løbe', category:'Movement',
    present:'løber', past:'løb', presPerfect:'har løbet', pastPerfect:'havde løbet',
    future:'vil løbe', conditional:'ville løbe', futPerfect:'vil have løbet',
    passive:'løbes', imperative:'løb',
  },
  {
    english:'to drive', danish:'at køre', category:'Movement',
    present:'kører', past:'kørte', presPerfect:'har kørt', pastPerfect:'havde kørt',
    future:'vil køre', conditional:'ville køre', futPerfect:'vil have kørt',
    passive:'køres', imperative:'kør',
  },
  {
    english:'to travel', danish:'at rejse', category:'Movement',
    present:'rejser', past:'rejste', presPerfect:'har rejst', pastPerfect:'havde rejst',
    future:'vil rejse', conditional:'ville rejse', futPerfect:'vil have rejst',
    passive:'rejses', imperative:'rejs',
  },
  // ── Communication ──
  {
    english:'to speak', danish:'at tale', category:'Communication',
    present:'taler', past:'talte', presPerfect:'har talt', pastPerfect:'havde talt',
    future:'vil tale', conditional:'ville tale', futPerfect:'vil have talt',
    passive:'tales', imperative:'tal',
  },
  {
    english:'to listen', danish:'at lytte', category:'Communication',
    present:'lytter', past:'lyttede', presPerfect:'har lyttet', pastPerfect:'havde lyttet',
    future:'vil lytte', conditional:'ville lytte', futPerfect:'vil have lyttet',
    passive:'lyttes', imperative:'lyt',
  },
  {
    english:'to read', danish:'at læse', category:'Communication',
    present:'læser', past:'læste', presPerfect:'har læst', pastPerfect:'havde læst',
    future:'vil læse', conditional:'ville læse', futPerfect:'vil have læst',
    passive:'læses', imperative:'læs',
  },
  {
    english:'to write', danish:'at skrive', category:'Communication',
    present:'skriver', past:'skrev', presPerfect:'har skrevet', pastPerfect:'havde skrevet',
    future:'vil skrive', conditional:'ville skrive', futPerfect:'vil have skrevet',
    passive:'skrives', imperative:'skriv',
  },
  {
    english:'to ask', danish:'at spørge', category:'Communication',
    present:'spørger', past:'spurgte', presPerfect:'har spurgt', pastPerfect:'havde spurgt',
    future:'vil spørge', conditional:'ville spørge', futPerfect:'vil have spurgt',
    passive:'spørges', imperative:'spørg',
  },
  {
    english:'to answer', danish:'at svare', category:'Communication',
    present:'svarer', past:'svarede', presPerfect:'har svaret', pastPerfect:'havde svaret',
    future:'vil svare', conditional:'ville svare', futPerfect:'vil have svaret',
    passive:'svares', imperative:'svar',
  },
  {
    english:'to understand', danish:'at forstå', category:'Communication',
    present:'forstår', past:'forstod', presPerfect:'har forstået', pastPerfect:'havde forstået',
    future:'vil forstå', conditional:'ville forstå', futPerfect:'vil have forstået',
    passive:'forstås', imperative:'forstå',
  },
  // ── Daily life ──
  {
    english:'to eat', danish:'at spise', category:'Daily life',
    present:'spiser', past:'spiste', presPerfect:'har spist', pastPerfect:'havde spist',
    future:'vil spise', conditional:'ville spise', futPerfect:'vil have spist',
    passive:'spises', imperative:'spis',
  },
  {
    english:'to drink', danish:'at drikke', category:'Daily life',
    present:'drikker', past:'drak', presPerfect:'har drukket', pastPerfect:'havde drukket',
    future:'vil drikke', conditional:'ville drikke', futPerfect:'vil have drukket',
    passive:'drikkes', imperative:'drik',
  },
  {
    english:'to sleep', danish:'at sove', category:'Daily life',
    present:'sover', past:'sov', presPerfect:'har sovet', pastPerfect:'havde sovet',
    future:'vil sove', conditional:'ville sove', futPerfect:'vil have sovet',
    passive:'—', imperative:'sov',
  },
  {
    english:'to work', danish:'at arbejde', category:'Daily life',
    present:'arbejder', past:'arbejdede', presPerfect:'har arbejdet', pastPerfect:'havde arbejdet',
    future:'vil arbejde', conditional:'ville arbejde', futPerfect:'vil have arbejdet',
    passive:'arbejdes', imperative:'arbejd',
  },
  {
    english:'to buy', danish:'at købe', category:'Daily life',
    present:'køber', past:'købte', presPerfect:'har købt', pastPerfect:'havde købt',
    future:'vil købe', conditional:'ville købe', futPerfect:'vil have købt',
    passive:'købes', imperative:'køb',
  },
  {
    english:'to help', danish:'at hjælpe', category:'Daily life',
    present:'hjælper', past:'hjalp', presPerfect:'har hjulpet', pastPerfect:'havde hjulpet',
    future:'vil hjælpe', conditional:'ville hjælpe', futPerfect:'vil have hjulpet',
    passive:'hjælpes', imperative:'hjælp',
  },
  {
    english:'to think', danish:'at tænke', category:'Daily life',
    present:'tænker', past:'tænkte', presPerfect:'har tænkt', pastPerfect:'havde tænkt',
    future:'vil tænke', conditional:'ville tænke', futPerfect:'vil have tænkt',
    passive:'tænkes', imperative:'tænk',
  },
  {
    english:'to feel', danish:'at føle', category:'Daily life',
    present:'føler', past:'følte', presPerfect:'har følt', pastPerfect:'havde følt',
    future:'vil føle', conditional:'ville føle', futPerfect:'vil have følt',
    passive:'føles', imperative:'føl',
  },
  {
    english:'to see', danish:'at se', category:'Daily life',
    present:'ser', past:'så', presPerfect:'har set', pastPerfect:'havde set',
    future:'vil se', conditional:'ville se', futPerfect:'vil have set',
    passive:'ses', imperative:'se',
  },
  {
    english:'to find', danish:'at finde', category:'Daily life',
    present:'finder', past:'fandt', presPerfect:'har fundet', pastPerfect:'havde fundet',
    future:'vil finde', conditional:'ville finde', futPerfect:'vil have fundet',
    passive:'findes', imperative:'find',
  },
  {
    english:'to give', danish:'at give', category:'Daily life',
    present:'giver', past:'gav', presPerfect:'har givet', pastPerfect:'havde givet',
    future:'vil give', conditional:'ville give', futPerfect:'vil have givet',
    passive:'gives', imperative:'giv',
  },
  {
    english:'to take', danish:'at tage', category:'Daily life',
    present:'tager', past:'tog', presPerfect:'har taget', pastPerfect:'havde taget',
    future:'vil tage', conditional:'ville tage', futPerfect:'vil have taget',
    passive:'tages', imperative:'tag',
  },
  {
    english:'to open', danish:'at åbne', category:'Daily life',
    present:'åbner', past:'åbnede', presPerfect:'har åbnet', pastPerfect:'havde åbnet',
    future:'vil åbne', conditional:'ville åbne', futPerfect:'vil have åbnet',
    passive:'åbnes', imperative:'åbn',
  },
  {
    english:'to close', danish:'at lukke', category:'Daily life',
    present:'lukker', past:'lukkede', presPerfect:'har lukket', pastPerfect:'havde lukket',
    future:'vil lukke', conditional:'ville lukke', futPerfect:'vil have lukket',
    passive:'lukkes', imperative:'luk',
  },
  {
    english:'to pay', danish:'at betale', category:'Daily life',
    present:'betaler', past:'betalte', presPerfect:'har betalt', pastPerfect:'havde betalt',
    future:'vil betale', conditional:'ville betale', futPerfect:'vil have betalt',
    passive:'betales', imperative:'betal',
  },
];

// ═══════════════════════════════════════════════
// ANIMALS
// Fields: english, danish, gender (en/et), plural,
//         male, female, young, group
// gender: 'en' = common (fælleskon), 'et' = neuter (intetkøn)
// ═══════════════════════════════════════════════
const ANIMALS = [
  // ── Farm ──
  { english:'cow',      danish:'ko',        gender:'en', plural:'køer',      male:'tyr',       female:'ko',       young:'kalv',     group:'Farm' },
  { english:'bull',     danish:'tyr',       gender:'en', plural:'tyre',      male:'tyr',       female:'ko',       young:'kalv',     group:'Farm' },
  { english:'calf',     danish:'kalv',      gender:'en', plural:'kalve',     male:'tyrekalv',  female:'kvieka',   young:'—',        group:'Farm' },
  { english:'sheep',    danish:'får',       gender:'et', plural:'får',       male:'vædder',    female:'søjte',    young:'lam',      group:'Farm' },
  { english:'ram',      danish:'vædder',    gender:'en', plural:'væddere',   male:'vædder',    female:'søjte',    young:'lam',      group:'Farm' },
  { english:'lamb',     danish:'lam',       gender:'et', plural:'lam',       male:'—',         female:'—',        young:'—',        group:'Farm' },
  { english:'pig',      danish:'gris',      gender:'en', plural:'grise',     male:'orne',      female:'so',       young:'pattegris',group:'Farm' },
  { english:'boar',     danish:'orne',      gender:'en', plural:'orner',     male:'orne',      female:'so',       young:'pattegris',group:'Farm' },
  { english:'sow',      danish:'so',        gender:'en', plural:'søer',      male:'orne',      female:'so',       young:'pattegris',group:'Farm' },
  { english:'horse',    danish:'hest',      gender:'en', plural:'heste',     male:'hingst',    female:'hoppe',    young:'føl',      group:'Farm' },
  { english:'stallion', danish:'hingst',    gender:'en', plural:'hingste',   male:'hingst',    female:'hoppe',    young:'føl',      group:'Farm' },
  { english:'mare',     danish:'hoppe',     gender:'en', plural:'hopper',    male:'hingst',    female:'hoppe',    young:'føl',      group:'Farm' },
  { english:'foal',     danish:'føl',       gender:'et', plural:'føl',       male:'—',         female:'—',        young:'—',        group:'Farm' },
  { english:'goat',     danish:'ged',       gender:'en', plural:'geder',     male:'buk',       female:'ged',      young:'killing',  group:'Farm' },
  { english:'billy goat',danish:'buk',      gender:'en', plural:'bukke',     male:'buk',       female:'ged',      young:'killing',  group:'Farm' },
  { english:'kid (goat)',danish:'killing',   gender:'en', plural:'killinger', male:'—',         female:'—',        young:'—',        group:'Farm' },
  { english:'chicken',  danish:'høne',      gender:'en', plural:'høns',      male:'hane',      female:'høne',     young:'kylling',  group:'Farm' },
  { english:'rooster',  danish:'hane',      gender:'en', plural:'haner',     male:'hane',      female:'høne',     young:'kylling',  group:'Farm' },
  { english:'chick',    danish:'kylling',   gender:'en', plural:'kyllinger', male:'—',         female:'—',        young:'—',        group:'Farm' },
  { english:'duck',     danish:'and',       gender:'en', plural:'ænder',     male:'andrik',    female:'and',      young:'ælling',   group:'Farm' },
  { english:'drake',    danish:'andrik',    gender:'en', plural:'andriker',  male:'andrik',    female:'and',      young:'ælling',   group:'Farm' },
  { english:'duckling', danish:'ælling',    gender:'en', plural:'ællinger',  male:'—',         female:'—',        young:'—',        group:'Farm' },
  { english:'goose',    danish:'gås',       gender:'en', plural:'gæs',       male:'gaserik',   female:'gås',      young:'gæsling',  group:'Farm' },
  { english:'turkey',   danish:'kalkun',    gender:'en', plural:'kalkuner',  male:'kalkun',    female:'kalkun',   young:'kalkunkylling', group:'Farm' },
  { english:'rabbit',   danish:'kanin',     gender:'en', plural:'kaniner',   male:'han-kanin', female:'hun-kanin',young:'unge',     group:'Farm' },
  { english:'donkey',   danish:'æsel',      gender:'et', plural:'æsler',     male:'hanæsel',   female:'hunæsel',  young:'æselføl',  group:'Farm' },
  { english:'cat',      danish:'kat',       gender:'en', plural:'katte',     male:'han-kat',   female:'hun-kat',  young:'killing',  group:'Farm' },
  { english:'dog',      danish:'hund',      gender:'en', plural:'hunde',     male:'han-hund',  female:'tæve',     young:'hvalp',    group:'Farm' },
  // ── Pets ──
  { english:'hamster',  danish:'hamster',   gender:'en', plural:'hamstere',  male:'—',         female:'—',        young:'unge',     group:'Pets' },
  { english:'guinea pig',danish:'marsvin',  gender:'et', plural:'marsvin',   male:'—',         female:'—',        young:'unge',     group:'Pets' },
  { english:'goldfish', danish:'guldfisk',  gender:'en', plural:'guldfisk',  male:'—',         female:'—',        young:'—',        group:'Pets' },
  { english:'budgerigar',danish:'undulat',  gender:'en', plural:'undulater', male:'—',         female:'—',        young:'—',        group:'Pets' },
  { english:'parrot',   danish:'papegøje',  gender:'en', plural:'papegøjer', male:'—',         female:'—',        young:'—',        group:'Pets' },
  { english:'turtle',   danish:'skildpadde',gender:'en', plural:'skildpadder',male:'—',        female:'—',        young:'—',        group:'Pets' },
  { english:'snake',    danish:'slange',    gender:'en', plural:'slanger',   male:'—',         female:'—',        young:'—',        group:'Pets' },
  // ── Zoo ──
  { english:'lion',     danish:'løve',      gender:'en', plural:'løver',     male:'løve',      female:'løvinde',  young:'løveunge', group:'Zoo' },
  { english:'tiger',    danish:'tiger',     gender:'en', plural:'tigre',     male:'tiger',     female:'tigerinde',young:'tigerunge',group:'Zoo' },
  { english:'elephant', danish:'elefant',   gender:'en', plural:'elefanter', male:'elefanttyr',female:'elefantko',young:'elefantkalv',group:'Zoo' },
  { english:'giraffe',  danish:'giraf',     gender:'en', plural:'giraffer',  male:'—',         female:'—',        young:'girafunge',group:'Zoo' },
  { english:'zebra',    danish:'zebra',     gender:'en', plural:'zebraer',   male:'—',         female:'—',        young:'zebraføl', group:'Zoo' },
  { english:'gorilla',  danish:'gorilla',   gender:'en', plural:'goriller',  male:'—',         female:'—',        young:'—',        group:'Zoo' },
  { english:'bear',     danish:'bjørn',     gender:'en', plural:'bjørne',    male:'bjørn',     female:'bjørnehun',young:'bjørneunge',group:'Zoo' },
  { english:'wolf',     danish:'ulv',       gender:'en', plural:'ulve',      male:'ulv',       female:'ulvinde',  young:'ulveunge', group:'Zoo' },
  { english:'fox',      danish:'ræv',       gender:'en', plural:'ræve',      male:'ræv',       female:'rævehan',  young:'rævehvalp',group:'Zoo' },
  { english:'deer',     danish:'hjort',     gender:'en', plural:'hjorte',    male:'hjort',     female:'hind',     young:'kalv',     group:'Zoo' },
  { english:'penguin',  danish:'pingvin',   gender:'en', plural:'pingviner', male:'—',         female:'—',        young:'—',        group:'Zoo' },
  { english:'crocodile',danish:'krokodille',gender:'en', plural:'krokodiller',male:'—',        female:'—',        young:'—',        group:'Zoo' },
  { english:'hippopotamus',danish:'flodhest',gender:'en',plural:'flodheste', male:'—',         female:'—',        young:'—',        group:'Zoo' },
  { english:'rhinoceros',danish:'næsehorn', gender:'et', plural:'næsehorn',  male:'—',         female:'—',        young:'—',        group:'Zoo' },
  { english:'monkey',   danish:'abe',       gender:'en', plural:'aber',      male:'—',         female:'—',        young:'abeunge',  group:'Zoo' },
  { english:'flamingo', danish:'flamingo',  gender:'en', plural:'flamingoer',male:'—',         female:'—',        young:'—',        group:'Zoo' },
  // ── Insects ──
  { english:'bee',      danish:'bi',        gender:'en', plural:'bier',      male:'dronebi',   female:'arbejderbi',young:'larve',   group:'Insects' },
  { english:'butterfly',danish:'sommerfugl',gender:'en', plural:'sommerfugle',male:'—',        female:'—',        young:'larve',    group:'Insects' },
  { english:'ant',      danish:'myre',      gender:'en', plural:'myrer',     male:'—',         female:'—',        young:'larve',    group:'Insects' },
  { english:'fly',      danish:'flue',      gender:'en', plural:'fluer',     male:'—',         female:'—',        young:'larve',    group:'Insects' },
  { english:'mosquito', danish:'myg',       gender:'en', plural:'myg',       male:'—',         female:'—',        young:'larve',    group:'Insects' },
  { english:'beetle',   danish:'bille',     gender:'en', plural:'biller',    male:'—',         female:'—',        young:'larve',    group:'Insects' },
  { english:'spider',   danish:'edderkop',  gender:'en', plural:'edderkopper',male:'—',        female:'—',        young:'—',        group:'Insects' },
  { english:'worm',     danish:'orm',       gender:'en', plural:'orme',      male:'—',         female:'—',        young:'—',        group:'Insects' },
  { english:'ladybird', danish:'mariehøne', gender:'en', plural:'mariehøns', male:'—',         female:'—',        young:'—',        group:'Insects' },
  { english:'grasshopper',danish:'græshoppe',gender:'en',plural:'græshopper',male:'—',        female:'—',        young:'—',        group:'Insects' },
];

// ═══════════════════════════════════════════════
// UTILS
// ═══════════════════════════════════════════════
function shuffle(arr){
  const a=[...arr];
  for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]; }
  return a;
}
function unique(arr){ return [...new Set(arr)]; }
function dash(v){ return (!v||v==='—')?'<span style="color:var(--border)">—</span>':v; }

// ═══════════════════════════════════════════════
// NAV
// ═══════════════════════════════════════════════
function showView(name,btn){
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('view-'+name).classList.add('active');
  btn.classList.add('active');
  ({translate:initTranslate, conjugation:initConj, animals:initAnimals, reference:initRef})[name]();
}

// ═══════════════════════════════════════════════
// TRANSLATE
// ═══════════════════════════════════════════════
let trQueue=[], trIdx=0, trFilter='all', trRevealed=false;

function initTranslate(){
  const cats = unique(VERBS.map(v=>v.category));
  const row = document.getElementById('tr-cat-filters');
  row.innerHTML=`<button class="filter-btn${trFilter==='all'?' active':''}" onclick="setTrFilter('all',this)">All</button>`;
  cats.forEach(c=>{ row.innerHTML+=`<button class="filter-btn${trFilter===c?' active':''}" onclick="setTrFilter('${c}',this)">${c}</button>`; });
  startTrQueue();
}
function setTrFilter(cat,btn){
  trFilter=cat;
  document.querySelectorAll('#tr-cat-filters .filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  startTrQueue();
}
function startTrQueue(){
  const pool=trFilter==='all'?VERBS:VERBS.filter(v=>v.category===trFilter);
  trQueue=shuffle(pool); trIdx=0; trRevealed=false; renderTrCard();
}
function renderTrCard(){
  const area=document.getElementById('tr-card');
  if(!trQueue.length){ area.innerHTML='<div class="empty-msg">No verbs found.</div>'; return; }
  const w=trQueue[trIdx]; trRevealed=false;
  area.innerHTML=`
    <div class="card">
      <div class="card-meta"><span>${w.category}</span><span>${trIdx+1} / ${trQueue.length}</span></div>
      <div class="card-prompt-label">Translate to Danish</div>
      <div class="card-main">${w.english}</div>
      <div>
        <input class="answer-input" id="tri" type="text" placeholder="type your answer…"
          autocomplete="off" autocorrect="off" spellcheck="false" onkeydown="trKey(event)">
        <div class="feedback-msg" id="trf"></div>
        <div class="reveal-box" id="trr">
          <div class="reveal-answer">${w.danish}</div>
          <div class="reveal-note">
            present: <strong>${w.present}</strong> &nbsp;·&nbsp;
            past: <strong>${w.past}</strong> &nbsp;·&nbsp;
            pres. perfect: <strong>${w.presPerfect}</strong>
          </div>
        </div>
      </div>
    </div>
    <div class="card-actions">
      <button class="btn ghost" onclick="trNext()">Skip →</button>
      <button class="btn" onclick="trCheck()">Check</button>
      <button class="btn primary" id="trnb" style="display:none;" onclick="trNext()">Next →</button>
    </div>`;
  document.getElementById('tri').focus();
}
function trKey(e){ if(e.key==='Enter'){ trRevealed?trNext():trCheck(); } }
function trCheck(){
  if(trRevealed) return;
  const w=trQueue[trIdx], val=document.getElementById('tri').value.trim().toLowerCase();
  if(!val){ trReveal(null); return; }
  const acc=[w.danish,w.present,w.past].filter(Boolean).map(s=>s.toLowerCase().replace(/^at /,''));
  trReveal(acc.includes(val.replace(/^at /,''))||val===w.danish.toLowerCase());
}
function trReveal(ok){
  trRevealed=true;
  const inp=document.getElementById('tri'),fb=document.getElementById('trf');
  document.getElementById('trr').classList.add('show');
  document.getElementById('trnb').style.display='';
  if(ok===true){ inp.classList.add('correct'); fb.textContent='✓ correct'; fb.className='feedback-msg correct'; }
  else if(ok===false){ inp.classList.add('wrong'); fb.textContent='✗ not quite — see answer below'; fb.className='feedback-msg wrong'; }
  else { fb.textContent='Answer revealed'; fb.className='feedback-msg'; }
}
function trNext(){ trIdx=(trIdx+1)%trQueue.length; renderTrCard(); }

// ═══════════════════════════════════════════════
// CONJUGATION
// ═══════════════════════════════════════════════
let cjQueue=[], cjIdx=0, cjVerb='all', cjTense='all', cjRevealed=false;

function initConj(){
  // verb filter
  const vrow=document.getElementById('cj-verb-filters');
  vrow.innerHTML=`<button class="filter-btn${cjVerb==='all'?' active':''}" onclick="setCjVerb('all',this)">All verbs</button>`;
  VERBS.forEach(v=>{
    const esc=v.danish.replace(/'/g,"\\'");
    vrow.innerHTML+=`<button class="filter-btn${cjVerb===v.danish?' active':''}" onclick="setCjVerb('${esc}',this)">${v.danish}</button>`;
  });
  // tense filter
  const trow=document.getElementById('cj-tense-filters');
  trow.innerHTML=`<button class="filter-btn${cjTense==='all'?' active':''}" onclick="setCjTense('all',this)">All tenses</button>`;
  TENSES.forEach(t=>{
    trow.innerHTML+=`<button class="filter-btn${cjTense===t.key?' active':''}" onclick="setCjTense('${t.key}',this)">${t.da} <span style="opacity:0.5;font-size:0.6em;">${t.label}</span></button>`;
  });
  startCjQueue();
}
function setCjVerb(verb,btn){
  cjVerb=verb;
  document.querySelectorAll('#cj-verb-filters .filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active'); startCjQueue();
}
function setCjTense(tense,btn){
  cjTense=tense;
  document.querySelectorAll('#cj-tense-filters .filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active'); startCjQueue();
}
function startCjQueue(){
  const pool=cjVerb==='all'?VERBS:VERBS.filter(v=>v.danish===cjVerb);
  const tenses=cjTense==='all'?TENSES.map(t=>t.key):[cjTense];
  const drills=[];
  pool.forEach(v=>{
    tenses.forEach(tk=>{
      const form=v[tk]; if(!form||form==='—') return;
      PRONOUNS.forEach(pro=>drills.push({verb:v,tense:tk,pronoun:pro,answer:form}));
    });
  });
  cjQueue=shuffle(drills); cjIdx=0; cjRevealed=false; renderCjCard();
}
function renderCjCard(){
  const area=document.getElementById('cj-card');
  if(!cjQueue.length){ area.innerHTML='<div class="empty-msg">No conjugations for this selection.<br>Some tenses (e.g. Imperative) don\'t apply to modal verbs.</div>'; return; }
  const d=cjQueue[cjIdx], v=d.verb; cjRevealed=false;
  const tObj=TENSES.find(t=>t.key===d.tense)||{label:d.tense,da:'',note:''};
  const tLabel=tObj.label;
  const tDa=tObj.da;
  const tNote=tObj.note||'';
  // mini table: all pronouns for this tense
  const tableRows=PRONOUNS.map(p=>`
    <tr class="${p.da===d.pronoun.da?'hl':''}">
      <td>${p.da}</td><td>${v[d.tense]||'—'}</td>
    </tr>`).join('');
  area.innerHTML=`
    <div class="card">
      <div class="card-meta"><span>${tDa} <span style="color:var(--border);margin:0 4px;">·</span> ${tLabel}</span><span>${cjIdx+1} / ${cjQueue.length}</span></div>
      <div class="card-prompt-label">${v.english} &nbsp;·&nbsp; ${v.danish}</div>
      <div class="pronoun-block">
        <div class="pronoun-badge">${d.pronoun.da}</div>
        <div class="pronoun-en">${d.pronoun.en}</div>
      </div>
      <div>
        <input class="answer-input" id="cji" type="text"
          placeholder="${d.pronoun.da} …"
          autocomplete="off" autocorrect="off" spellcheck="false"
          onkeydown="cjKey(event)">
        <div class="feedback-msg" id="cjf"></div>
        <div class="reveal-box" id="cjr">
          <div class="reveal-answer">${d.pronoun.da} ${d.answer}</div>
          <div class="reveal-note">
            ${tDa} (${tLabel}) — same form for all pronouns
            ${tNote?'<br><span style="color:var(--muted)">e.g. '+tNote+'</span>':''}
          </div>
          <table class="conj-mini">${tableRows}</table>
        </div>
      </div>
    </div>
    <div class="card-actions">
      <button class="btn ghost" onclick="cjNext()">Skip →</button>
      <button class="btn" onclick="cjCheck()">Check</button>
      <button class="btn primary" id="cjnb" style="display:none;" onclick="cjNext()">Next →</button>
    </div>`;
  document.getElementById('cji').focus();
}
function cjKey(e){ if(e.key==='Enter'){ cjRevealed?cjNext():cjCheck(); } }
function cjCheck(){
  if(cjRevealed) return;
  const d=cjQueue[cjIdx], val=document.getElementById('cji').value.trim().toLowerCase();
  if(!val){ cjReveal(null); return; }
  const ans=d.answer.toLowerCase();
  const stripped=val.replace(/^(jeg|du|han\/hun|han|hun|den\/det|den|det|vi|i|de)\s+/,'');
  cjReveal(val===ans||stripped===ans);
}
function cjReveal(ok){
  cjRevealed=true;
  const inp=document.getElementById('cji'),fb=document.getElementById('cjf');
  document.getElementById('cjr').classList.add('show');
  document.getElementById('cjnb').style.display='';
  if(ok===true){ inp.classList.add('correct'); fb.textContent='✓ correct'; fb.className='feedback-msg correct'; }
  else if(ok===false){ inp.classList.add('wrong'); fb.textContent='✗ not quite — see answer below'; fb.className='feedback-msg wrong'; }
  else { fb.textContent='Answer revealed'; fb.className='feedback-msg'; }
}
function cjNext(){ cjIdx=(cjIdx+1)%cjQueue.length; renderCjCard(); }

// ═══════════════════════════════════════════════
// ANIMALS
// ═══════════════════════════════════════════════
let anQueue=[], anIdx=0, anGroup='all', anMode='en-da', anRevealed=false;

function initAnimals(){
  const groups=unique(ANIMALS.map(a=>a.group));
  const row=document.getElementById('an-group-filters');
  row.innerHTML=`<button class="filter-btn${anGroup==='all'?' active':''}" onclick="setAnGroup('all',this)">All</button>`;
  groups.forEach(g=>{ row.innerHTML+=`<button class="filter-btn${anGroup===g?' active':''}" onclick="setAnGroup('${g}',this)">${g}</button>`; });
  startAnQueue();
}
function setAnGroup(g,btn){
  anGroup=g;
  document.querySelectorAll('#an-group-filters .filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active'); startAnQueue();
}
function setAnimalMode(mode,btn){
  anMode=mode;
  document.querySelectorAll('#an-mode-filters .filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active'); startAnQueue();
}
function startAnQueue(){
  const pool=anGroup==='all'?ANIMALS:ANIMALS.filter(a=>a.group===anGroup);
  anQueue=shuffle(pool); anIdx=0; anRevealed=false; renderAnCard();
}

function hasExtraForms(a){
  return [a.male,a.female,a.young].some(v=>v&&v!=='—');
}

function renderAnCard(){
  const area=document.getElementById('an-card');
  if(!anQueue.length){ area.innerHTML='<div class="empty-msg">No animals found.</div>'; return; }
  const a=anQueue[anIdx]; anRevealed=false;
  const prompt = anMode==='en-da' ? a.english : a.danish;
  const answer = anMode==='en-da' ? a.danish  : a.english;
  const genderBadge = `<span class="gender-tag gender-${a.gender}">${a.gender}-word</span>`;

  // forms for reveal
  const formsHtml = hasExtraForms(a) ? `
    <div style="margin-top:10px;font-size:0.65rem;letter-spacing:0.1em;text-transform:uppercase;color:var(--muted);margin-bottom:6px;">Forms</div>
    <div class="forms-grid">
      <div><div class="form-cell-label">Male</div><div class="form-cell-val">${a.male!=='—'?a.male:'—'}</div></div>
      <div><div class="form-cell-label">Female</div><div class="form-cell-val">${a.female!=='—'?a.female:'—'}</div></div>
      <div><div class="form-cell-label">Young</div><div class="form-cell-val">${a.young!=='—'?a.young:'—'}</div></div>
    </div>` : '';

  area.innerHTML=`
    <div class="card">
      <div class="card-meta"><span>${a.group}</span><span>${anIdx+1} / ${anQueue.length}</span></div>
      <div class="card-prompt-label">${anMode==='en-da'?'Translate to Danish':'Translate to English'}</div>
      <div class="card-main">${prompt}</div>
      <div>
        <input class="answer-input" id="ani" type="text" placeholder="your answer…"
          autocomplete="off" autocorrect="off" spellcheck="false" onkeydown="anKey(event)">
        <div class="feedback-msg" id="anf"></div>
        <div class="reveal-box" id="anr">
          <div class="reveal-answer">${answer} ${anMode==='en-da'?genderBadge:''}</div>
          <div class="reveal-note">
            ${anMode==='en-da'?`plural: <strong>${a.plural}</strong>`:`Danish: <strong>${a.danish}</strong> · plural: <strong>${a.plural}</strong>`}
          </div>
          ${formsHtml}
        </div>
      </div>
    </div>
    <div class="card-actions">
      <button class="btn ghost" onclick="anNext()">Skip →</button>
      <button class="btn" onclick="anCheck()">Check</button>
      <button class="btn primary" id="annb" style="display:none;" onclick="anNext()">Next →</button>
    </div>`;
  document.getElementById('ani').focus();
}
function anKey(e){ if(e.key==='Enter'){ anRevealed?anNext():anCheck(); } }
function anCheck(){
  if(anRevealed) return;
  const a=anQueue[anIdx], val=document.getElementById('ani').value.trim().toLowerCase();
  if(!val){ anReveal(null); return; }
  const target=(anMode==='en-da'?a.danish:a.english).toLowerCase();
  // also accept without article prefix
  anReveal(val===target||val===target.replace(/^(en|et) /,''));
}
function anReveal(ok){
  anRevealed=true;
  const inp=document.getElementById('ani'),fb=document.getElementById('anf');
  document.getElementById('anr').classList.add('show');
  document.getElementById('annb').style.display='';
  if(ok===true){ inp.classList.add('correct'); fb.textContent='✓ correct'; fb.className='feedback-msg correct'; }
  else if(ok===false){ inp.classList.add('wrong'); fb.textContent='✗ not quite — see answer below'; fb.className='feedback-msg wrong'; }
  else { fb.textContent='Answer revealed'; fb.className='feedback-msg'; }
}
function anNext(){ anIdx=(anIdx+1)%anQueue.length; renderAnCard(); }

// ═══════════════════════════════════════════════
// REFERENCE
// ═══════════════════════════════════════════════
let refType='verbs';

function initRef(){
  renderVerbRef();
  populateAnimalRefDropdown();
}
function setRefType(type,btn){
  refType=type;
  document.querySelectorAll('#ref-type-filters .filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('ref-verbs-section').style.display=type==='verbs'?'':'none';
  document.getElementById('ref-animals-section').style.display=type==='animals'?'':'none';
  if(type==='verbs') renderVerbRef();
  else renderAnimalRef();
}

function renderVerbRef(){
  // populate cat dropdown once
  const sel=document.getElementById('ref-verb-cat');
  if(sel.options.length===1){
    unique(VERBS.map(v=>v.category)).sort().forEach(c=>sel.innerHTML+=`<option value="${c}">${c}</option>`);
  }
  const q=(document.getElementById('ref-verb-search')?.value||'').toLowerCase();
  const cat=sel.value;
  const filtered=VERBS.filter(v=>{
    const mc=cat==='all'||v.category===cat;
    const ms=!q||Object.values(v).some(s=>typeof s==='string'&&s.toLowerCase().includes(q));
    return mc&&ms;
  });
  document.getElementById('ref-verb-body').innerHTML=filtered.map(v=>`<tr>
    <td class="cell-en">${v.english}</td>
    <td class="cell-da">${v.danish}</td>
    <td>${dash(v.present)}</td><td>${dash(v.past)}</td>
    <td>${dash(v.presPerfect)}</td><td>${dash(v.pastPerfect)}</td>
    <td>${dash(v.future)}</td><td>${dash(v.conditional)}</td>
    <td>${dash(v.futPerfect)}</td><td>${dash(v.passive)}</td><td>${dash(v.imperative)}</td>
    <td><span class="tag">${v.category}</span></td>
  </tr>`).join('');
}

function populateAnimalRefDropdown(){
  const sel=document.getElementById('ref-animal-group');
  if(sel.options.length===1){
    unique(ANIMALS.map(a=>a.group)).forEach(g=>sel.innerHTML+=`<option value="${g}">${g}</option>`);
  }
}
function renderAnimalRef(){
  populateAnimalRefDropdown();
  const q=(document.getElementById('ref-animal-search')?.value||'').toLowerCase();
  const grp=document.getElementById('ref-animal-group').value;
  const filtered=ANIMALS.filter(a=>{
    const mg=grp==='all'||a.group===grp;
    const ms=!q||[a.english,a.danish,a.plural,a.male,a.female,a.young].some(s=>(s||'').toLowerCase().includes(q));
    return mg&&ms;
  });
  document.getElementById('ref-animal-body').innerHTML=filtered.map(a=>`<tr>
    <td class="cell-en">${a.english}</td>
    <td class="cell-da">${a.danish}</td>
    <td><span class="gender-tag gender-${a.gender}">${a.gender}</span></td>
    <td>${dash(a.plural)}</td>
    <td>${dash(a.male)}</td><td>${dash(a.female)}</td><td>${dash(a.young)}</td>
    <td><span class="tag">${a.group}</span></td>
  </tr>`).join('');
}

// ═══════════════════════════════════════════════
// INIT
// ═══════════════════════════════════════════════
initTranslate();
</script>
</body>
</html>
